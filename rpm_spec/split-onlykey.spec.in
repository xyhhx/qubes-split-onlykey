Name:     split-onlykey
Version:  @VERSION@ 
Release:  1%{?dist}
Summary:  Proxy CTAP and SSH to a dedicated Onlykey Qube


Group:      Qubes
License:    HL3-FULL
BuildArch:  noarch

BuildRequires: make
BuildRequires: python%{python3_pkgversion}-devel
BuildRequires: rpmautospec
BuildRequires: systemd

Requires: %{pypi_source onlykey-agent}
Requires: %{pypi_source onlykey}
Requires: bash
Requires: dbus-x11
Requires: gnupg2
Requires: libusb1-devel
Requires: pipx
Requires: python%{python3_pkgversion}
Requires: qubes-ctap
Requires: qubes-usb-proxy
Requires: socat
Requires: usbutils

Recommends: desktop-notification-daemon
Recommends: libnotify

Source0: %{name}-%{version}.tar.gz

%description
Proxy CTAP and SSH to a dedicated Onlykey Qube. 

%prep
%setup -q

%post
%systemd_post onlykey-agent.service

%preun
%systemd_preun onlykey-agent.service

%postun
%systemd_postun_with_restart onlykey-agent.service

%install
make install-vm DESTDIR=${RPM_BUILD_ROOT}

%files
%doc

%{_udevrulesdir}/49-onlykey.rules
%{_libdir}/qubes/ok-ssh-proxy

%{_sysconfdir}/qubes-rpc/onlykey.SshAgent

%{_presetdir}/49-onlykey-agent.preset
%{_unitdir}/onlykey-agent.socket
%{_unitdir}/onlykey-agent.service

%{_docdir}/split-onlykey/README.md

%autochangelog
